{"version":3,"file":"createAwsUploader.cjs","sources":["../../src/createAwsUploader.ts"],"sourcesContent":["import { S3Client, PutObjectCommand } from '@aws-sdk/client-s3';\nimport {\n  createGenericFileFromJson,\n  GenericFile,\n  lamports,\n  SolAmount,\n  UploaderInterface,\n} from '@metaplex-foundation/umi';\n\nexport function createAwsUploader(\n  client: S3Client,\n  bucketName: string\n): UploaderInterface & { getUrl: (key: string) => Promise<string> } {\n  const uploadOne = async (file: GenericFile): Promise<string> => {\n    const command = new PutObjectCommand({\n      Bucket: bucketName,\n      Key: file.uniqueName,\n      Body: file.buffer,\n      ContentType: file.contentType || undefined,\n    });\n\n    await client.send(command);\n\n    return getUrl(file.uniqueName);\n  };\n\n  const upload = async (files: GenericFile[]): Promise<string[]> =>\n    Promise.all(files.map((file) => uploadOne(file)));\n\n  const uploadJson = async <T>(json: T): Promise<string> => {\n    const file = createGenericFileFromJson(json);\n    const uris = await upload([file]);\n    return uris[0];\n  };\n\n  const getUploadPrice = async (): Promise<SolAmount> => lamports(0);\n\n  const getUrl = async (key: string) => {\n    const region = await client.config.region();\n    const encodedKey = encodeURIComponent(key);\n\n    return `https://s3.${region}.amazonaws.com/${bucketName}/${encodedKey}`;\n  };\n\n  return {\n    upload,\n    uploadJson,\n    getUploadPrice,\n    getUrl,\n  };\n}\n"],"names":["createAwsUploader","client","bucketName","uploadOne","file","command","PutObjectCommand","Bucket","Key","uniqueName","Body","buffer","ContentType","contentType","undefined","send","getUrl","upload","files","Promise","all","map","uploadJson","json","createGenericFileFromJson","uris","getUploadPrice","lamports","key","region","config","encodedKey","encodeURIComponent"],"mappings":";;;;;;;AASO,SAASA,iBAAiB,CAC/BC,MAAgB,EAChBC,UAAkB,EACgD;AAClE,EAAA,MAAMC,SAAS,GAAG,MAAOC,IAAiB,IAAsB;AAC9D,IAAA,MAAMC,OAAO,GAAG,IAAIC,yBAAgB,CAAC;AACnCC,MAAAA,MAAM,EAAEL,UAAU;MAClBM,GAAG,EAAEJ,IAAI,CAACK,UAAU;MACpBC,IAAI,EAAEN,IAAI,CAACO,MAAM;AACjBC,MAAAA,WAAW,EAAER,IAAI,CAACS,WAAW,IAAIC,SAAAA;AACnC,KAAC,CAAC,CAAA;AAEF,IAAA,MAAMb,MAAM,CAACc,IAAI,CAACV,OAAO,CAAC,CAAA;AAE1B,IAAA,OAAOW,MAAM,CAACZ,IAAI,CAACK,UAAU,CAAC,CAAA;GAC/B,CAAA;EAED,MAAMQ,MAAM,GAAG,MAAOC,KAAoB,IACxCC,OAAO,CAACC,GAAG,CAACF,KAAK,CAACG,GAAG,CAAEjB,IAAI,IAAKD,SAAS,CAACC,IAAI,CAAC,CAAC,CAAC,CAAA;AAEnD,EAAA,MAAMkB,UAAU,GAAG,MAAUC,IAAO,IAAsB;AACxD,IAAA,MAAMnB,IAAI,GAAGoB,6BAAyB,CAACD,IAAI,CAAC,CAAA;IAC5C,MAAME,IAAI,GAAG,MAAMR,MAAM,CAAC,CAACb,IAAI,CAAC,CAAC,CAAA;IACjC,OAAOqB,IAAI,CAAC,CAAC,CAAC,CAAA;GACf,CAAA;AAED,EAAA,MAAMC,cAAc,GAAG,YAAgCC,YAAQ,CAAC,CAAC,CAAC,CAAA;AAElE,EAAA,MAAMX,MAAM,GAAG,MAAOY,GAAW,IAAK;IACpC,MAAMC,MAAM,GAAG,MAAM5B,MAAM,CAAC6B,MAAM,CAACD,MAAM,EAAE,CAAA;AAC3C,IAAA,MAAME,UAAU,GAAGC,kBAAkB,CAACJ,GAAG,CAAC,CAAA;AAE1C,IAAA,OAAQ,cAAaC,MAAO,CAAA,eAAA,EAAiB3B,UAAW,CAAA,CAAA,EAAG6B,UAAW,CAAC,CAAA,CAAA;GACxE,CAAA;EAED,OAAO;IACLd,MAAM;IACNK,UAAU;IACVI,cAAc;AACdV,IAAAA,MAAAA;GACD,CAAA;AACH;;;;"}